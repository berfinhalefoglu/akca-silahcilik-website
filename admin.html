<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>YÃ¶netim Paneli | AkÃ§a SilahÃ§Ä±lÄ±k</title>
    
    <link rel="stylesheet" href="css/admin.css">
</head>
<body>

    <aside>
        <h2>YÃ–NETÄ°M PANELÄ°</h2>
        <nav>
            <button onclick="show('users')" class="active-btn" id="btn-users">ðŸ‘¥ Ãœyeler</button>
            <button onclick="show('create')" id="btn-create">âž• Yeni Ãœye Ekle</button>
            <button onclick="show('logs')" id="btn-logs">ðŸ“‹ GiriÅŸ LoglarÄ±</button>
        </nav>
        <button onclick="location.href='index.html'" class="logout-btn">Ã‡Ä±kÄ±ÅŸ Yap</button>
    </aside>

    <main>
        
        <div id="users-sec">
            <h2>Ãœye Listesi</h2>
            <table id="user-table">
                </table>
        </div>

        <div id="create-sec" style="display:none;">
            <h2>Yeni Ãœye OluÅŸtur</h2>
            <div class="input-group">
                <label>KullanÄ±cÄ± AdÄ±</label>
                <input type="text" id="new-user" placeholder="Ã–rn: mehmet_yilmaz">
                
                <label>Åžifre</label>
                <input type="text" id="new-pass" placeholder="Ã–rn: 123456">
                
                <button class="btn btn-save" onclick="createUser()">KullanÄ±cÄ±yÄ± Kaydet</button>
            </div>
        </div>

        <div id="logs-sec" style="display:none;">
            <h2>GiriÅŸ LoglarÄ±</h2>
            <ul id="log-list">
                </ul>
        </div>

    </main>

    <script>
        async function loadData() {
            // 1. KullanÄ±cÄ±larÄ± Ã‡ek
            const uRes = await fetch('/api/admin/users');
            const users = await uRes.json();
            
            document.getElementById('user-table').innerHTML = `
                <thead>
                    <tr>
                        <th>KullanÄ±cÄ± AdÄ±</th>
                        <th>Durum</th>
                        <th>Ä°ÅŸlem</th>
                    </tr>
                </thead>
                <tbody>
                ${users.map(u => u.role !== 'admin' ? `
                <tr>
                    <td>${u.username}</td>
                    <td><span class="status-badge ${u.isSuspended ? 'status-suspended' : 'status-active'}">
                        ${u.isSuspended ? 'ASKIDA' : 'AKTÄ°F'}
                    </span></td>
                    <td>
                        <button class="btn ${u.isSuspended ? 'btn-green' : 'btn-red'}" onclick="toggle(${u.id})">
                            ${u.isSuspended ? 'Aktif Et' : 'AskÄ±ya Al'}
                        </button>
                    </td>
                </tr>` : '').join('')}
                </tbody>`;

            // 2. LoglarÄ± Ã‡ek
            const lRes = await fetch('/api/admin/logs');
            const logs = await lRes.json();
            
            document.getElementById('log-list').innerHTML = logs.map(l => 
                `<li>
                    <strong>${l.username}</strong> sisteme giriÅŸ yaptÄ±. <br>
                    <small style="color:#888;">${l.date} | IP: ${l.ip}</small>
                </li>`
            ).join('');
        }

        // Yeni KullanÄ±cÄ± OluÅŸturma
        async function createUser() {
            const username = document.getElementById('new-user').value;
            const password = document.getElementById('new-pass').value;
            
            if(!username || !password) { alert("LÃ¼tfen tÃ¼m alanlarÄ± doldurun!"); return; }

            const res = await fetch('/api/admin/create-user', {
                method: 'POST', headers: {'Content-Type':'application/json'},
                body: JSON.stringify({newUsername: username, newPassword: password})
            });
            const d = await res.json();
            alert(d.message);
            if(d.success) {
                document.getElementById('new-user').value = "";
                document.getElementById('new-pass').value = "";
                show('users'); // Listeye geri dÃ¶n
                loadData();
            }
        }

        // Durum DeÄŸiÅŸtirme
        async function toggle(id) {
            if(!confirm("KullanÄ±cÄ±nÄ±n durumunu deÄŸiÅŸtirmek istiyor musunuz?")) return;
            await fetch('/api/admin/toggle-status', {
                method: 'POST', headers: {'Content-Type':'application/json'},
                body: JSON.stringify({userId: id})
            });
            loadData();
        }

        // MenÃ¼ GeÃ§iÅŸleri
        function show(id) {
            // TÃ¼m bÃ¶lÃ¼mleri gizle
            ['users-sec','create-sec','logs-sec'].forEach(d => document.getElementById(d).style.display = 'none');
            // SeÃ§ileni gÃ¶ster
            document.getElementById(id+'-sec').style.display = 'block';

            // Buton aktiflik sÄ±nÄ±flarÄ±nÄ± ayarla
            document.querySelectorAll('aside nav button').forEach(btn => btn.classList.remove('active-btn'));
            document.getElementById('btn-' + id).classList.add('active-btn');
        }

        // Sayfa aÃ§Ä±lÄ±nca verileri yÃ¼kle
        loadData();
    </script>
</body>
</html>